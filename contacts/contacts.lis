     1                                  ; Program Name: "". This program demonstrates.  Copyright (C) 2025  Dianella Sy
     2                                  
     3                                  ; This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License  
     4                                  ; version 3 as published by the Free Software Foundation.                                                                    
     5                                  ; This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied         
     6                                  ; warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.      
     7                                  ; A copy of the GNU General Public License v3 is available here: <https://www.gnu.org/licenses/>.
     8                                  
     9                                  ; Author Information:
    10                                  ; Name:
    11                                  ; CWID:
    12                                  ; Section: CPSC 240-#
    13                                  ; Email: @csu.fullerton.edu
    14                                  
    15                                  ; Program Information:
    16                                  ; Name:
    17                                  ; Languages:
    18                                  ; Start Date:
    19                                  ; Completion Date:
    20                                  
    21                                  ; Program's Purpose:
    22                                  ; The "" will teach.
    23                                  
    24                                  ; Project Information:
    25                                  ; Files: 
    26                                  ; Developing Computer: 
    27                                  ; Status:
    28                                  
    29                                  ; Translator Information:
    30                                  ; Linux:
    31                                  ; Linux:
    32                                  
    33                                  %include "activation_record.inc"
     1                              <1> ; This is an include file for the program Contacts List
     2                              <1> 
     3                              <1> ; Macro that backs up all the GPRs
     4                              <1> %macro create_activation_record 0    
     5                              <1>    push rbp
     6                              <1>    mov rbp, rsp
     7                              <1>    push rbx
     8                              <1>    push rcx
     9                              <1>    push rdx
    10                              <1>    push rdi
    11                              <1>    push rsi
    12                              <1>    push r8
    13                              <1>    push r9
    14                              <1>    push r10
    15                              <1>    push r11
    16                              <1>    push r12
    17                              <1>    push r13
    18                              <1>    push r14
    19                              <1>    push r15
    20                              <1>    pushf
    21                              <1> %endmacro
    22                              <1> 
    23                              <1> 
    24                              <1> ; Macro delete activation record 
    25                              <1> %macro delete_activation_record 0
    26                              <1> popf
    27                              <1> pop r15
    28                              <1> pop r14
    29                              <1> pop r13
    30                              <1> pop r12
    31                              <1> pop r11
    32                              <1> pop r10
    33                              <1> pop r9
    34                              <1> pop r8
    35                              <1> pop rsi
    36                              <1> pop rdi
    37                              <1> pop rdx
    38                              <1> pop rcx
    39                              <1> pop rbx
    40                              <1> pop rbp
    41                              <1> %endmacro
    34                                  extern fgets
    35                                  extern stdin
    36                                  extern printf
    37                                  
    38                                  
    39                                  global contacts
    40                                  
    41                                  
    42                                  ; segment .data is where initalized data is declared
    43                                  
    44                                  segment .data
    45                                  
    46                                  align 16
    47                                  
    48 00000000 456E74657220612073-     output_program_instructions db "Enter a sequence of phone numbers separated by white space (format: 714714714).", 10, 0
    48 00000009 657175656E6365206F-
    48 00000012 662070686F6E65206E-
    48 0000001B 756D62657273207365-
    48 00000024 706172617465642062-
    48 0000002D 792077686974652073-
    48 00000036 706163652028666F72-
    48 0000003F 6D61743A2037313437-
    48 00000048 3134373134292E0A00 
    49                                  
    50 00000051 416674657220746865-     prompt_sequence_of_phone_numbers db "After the last input, press enter followed by Control+D: ", 10, 0
    50 0000005A 206C61737420696E70-
    50 00000063 75742C207072657373-
    50 0000006C 20656E74657220666F-
    50 00000075 6C6C6F776564206279-
    50 0000007E 20436F6E74726F6C2B-
    50 00000087 443A200A00         
    51                                  
    52 0000008C 0A546869732070726F-     output_program_will_return_execution_to_the_main_function db 10, "This program will return execution to the main function.", 10, 0 
    52 00000095 6772616D2077696C6C-
    52 0000009E 2072657475726E2065-
    52 000000A7 7865637574696F6E20-
    52 000000B0 746F20746865206D61-
    52 000000B9 696E2066756E637469-
    52 000000C2 6F6E2E0A00         
    53                                  
    54 000000C7 257300                  string_format db "%s", 0  
    55                                  
    56                                  
    57                                  
    58                                  
    59                                  
    60                                  ; segment .bss is where uninitialized data is declared 
    61                                  
    62                                  segment .bss
    63                                  
    64                                  
    65                                  
    66                                  
    67                                  
    68                                  ; segment .text is the code 
    69                                  
    70                                  segment .text
    71                                  
    72                                  ; The header or label 'contacts:' defines the initial program entry point
    73                                  contacts:
    74                                  
    75                                  ; Macro backs up the GPRs
    76                                  create_activation_record
     5 00000000 55                  <1>  push rbp
     6 00000001 4889E5              <1>  mov rbp, rsp
     7 00000004 53                  <1>  push rbx
     8 00000005 51                  <1>  push rcx
     9 00000006 52                  <1>  push rdx
    10 00000007 57                  <1>  push rdi
    11 00000008 56                  <1>  push rsi
    12 00000009 4150                <1>  push r8
    13 0000000B 4151                <1>  push r9
    14 0000000D 4152                <1>  push r10
    15 0000000F 4153                <1>  push r11
    16 00000011 4154                <1>  push r12
    17 00000013 4155                <1>  push r13
    18 00000015 4156                <1>  push r14
    19 00000017 4157                <1>  push r15
    20 00000019 9C                  <1>  pushf
    77                                  
    78                                  
    79                                  ; Output program instructions
    80 0000001A B800000000              mov  rax, 0
    81 0000001F 48BF-                   mov  rdi, string_format
    81 00000021 [C700000000000000] 
    82 00000029 48BE-                   mov  rsi, output_program_instructions
    82 0000002B [0000000000000000] 
    83 00000033 E8(00000000)            call printf
    84                                  
    85                                  
    86                                  ; Ask for a sequence of phone numbers
    87 00000038 B800000000              mov  rax, 0
    88 0000003D 48BF-                   mov  rdi, string_format
    88 0000003F [C700000000000000] 
    89 00000047 48BE-                   mov  rsi, prompt_sequence_of_phone_numbers
    89 00000049 [5100000000000000] 
    90 00000051 E8(00000000)            call printf
    91                                  
    92                                  
    93                                  ; Create 800 bytes for the incoming phone number (maximum number of bytes the user can input for the phone number)
    94 00000056 4881EC20030000          sub rsp, 800
    95                                  
    96                                  
    97                                  begin_loop:
    98                                  ; Obtain a phone number from the keyboard 
    99 0000005D B800000000              mov rax, 0
   100 00000062 4889E7                  mov rdi, rsp
   101 00000065 BE1F030000              mov rsi, 799
   102 0000006A 488B1425[00000000]      mov rdx, [stdin]
   103 00000072 E8(00000000)            call fgets
   104                                  
   105                                  
   106                                  ; Check if the user does Control+D
   107 00000077 4883F800                cmp rax, 0
   108 0000007B 7402                    je finish_loop
   109 0000007D 75DE                    jne begin_loop
   110                                  
   111                                  
   112                                  finish_loop:
   113                                  ; Reverse the subtraction from creating 800 bytes for the incoming phone number
   114 0000007F 4881C420030000          add rsp, 800
   115                                  
   116                                  
   117                                  ; Output that the program will return execution to the main function
   118 00000086 B800000000              mov  rax, 0
   119 0000008B 48BF-                   mov  rdi, string_format
   119 0000008D [C700000000000000] 
   120 00000095 48BE-                   mov  rsi, output_program_will_return_execution_to_the_main_function
   120 00000097 [8C00000000000000] 
   121 0000009F E8(00000000)            call printf
   122                                  
   123                                  
   124                                  ; Restore original values to general registers
   125                                  delete_activation_record
    26 000000A4 9D                  <1> popf
    27 000000A5 415F                <1> pop r15
    28 000000A7 415E                <1> pop r14
    29 000000A9 415D                <1> pop r13
    30 000000AB 415C                <1> pop r12
    31 000000AD 415B                <1> pop r11
    32 000000AF 415A                <1> pop r10
    33 000000B1 4159                <1> pop r9
    34 000000B3 4158                <1> pop r8
    35 000000B5 5E                  <1> pop rsi
    36 000000B6 5F                  <1> pop rdi
    37 000000B7 5A                  <1> pop rdx
    38 000000B8 59                  <1> pop rcx
    39 000000B9 5B                  <1> pop rbx
    40 000000BA 5D                  <1> pop rbp
   126                                  
   127 000000BB C3                      ret
